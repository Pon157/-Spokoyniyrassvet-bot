<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç –°–∏—Å—Ç–µ–º–∞ - –û–±—â–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/light-theme.css" id="theme-style">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="container">
                <h1 class="logo">üí¨ –ß–∞—Ç–°–∏—Å—Ç–µ–º–∞</h1>
                <div class="header-actions">
                    <span id="userWelcome"></span>
                    <div class="theme-selector">
                        <button class="btn btn-icon" id="themeToggle">üé®</button>
                        <div class="theme-dropdown" id="themeDropdown">
                            <div class="theme-option" data-theme="light">üåû –°–≤–µ—Ç–ª–∞—è</div>
                            <div class="theme-option" data-theme="dark">üåô –¢–µ–º–Ω–∞—è</div>
                            <div class="theme-option" data-theme="blue">üîµ –°–∏–Ω—è—è</div>
                            <div class="theme-option" data-theme="green">üü¢ –ó–µ–ª–µ–Ω–∞—è</div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="openSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn btn-outline" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
                </div>
            </div>
        </header>

        <main class="chat-container">
            <!-- –°–∞–π–¥–±–∞—Ä -->
            <aside class="chat-sidebar">
                <div class="sidebar-section">
                    <h3>–ú–æ–∏ —á–∞—Ç—ã</h3>
                    <div id="chatsList" class="chats-list">
                        <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>

                <div class="sidebar-section" id="listenersSection" style="display: none;">
                    <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏</h3>
                    <div id="listenersList" class="users-list">
                        <!-- –°–ø–∏—Å–æ–∫ —Å–ª—É—à–∞—Ç–µ–ª–µ–π -->
                    </div>
                </div>

                <div class="sidebar-section" id="activeUsersSection">
                    <h3>–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</h3>
                    <div id="activeUsersList" class="users-list">
                        <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
                    </div>
                </div>
            </aside>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
            <div class="chat-main">
                <div class="chat-header" id="chatHeader" style="display: none;">
                    <div class="chat-info">
                        <h3 id="chatWithUser"></h3>
                        <span id="userStatus" class="status-offline"></span>
                    </div>
                    <div class="chat-actions">
                        <button class="btn btn-outline btn-sm" id="endChatBtn" style="display: none;">
                            –ó–∞–≤–µ—Ä—à–∏—Ç—å —á–∞—Ç
                        </button>
                        <button class="btn btn-outline btn-sm" id="rateChatBtn" style="display: none;">
                            –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
                        </button>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="no-chat-selected" id="noChatSelected">
                        <div class="welcome-message">
                            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç!</h2>
                            <p id="welcomeText">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä</p>
                            <button class="btn btn-primary mt-2" id="startChatBtn" style="display: none;">
                                –ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
                            </button>
                        </div>
                    </div>
                </div>

                <div class="message-input-container" id="messageInputContainer" style="display: none;">
                    <form class="message-input-form" id="messageForm">
                        <div class="message-actions">
                            <button type="button" class="btn btn-icon" onclick="openMediaPicker()">üìé</button>
                            <button type="button" class="btn btn-icon" onclick="openStickerPicker()">üòä</button>
                            <button type="button" class="btn btn-icon" onclick="startVoiceRecording()">üé§</button>
                        </div>
                        <textarea 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                            rows="1"
                            oninput="autoResize(this)"
                        ></textarea>
                        <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </form>
                    <div id="typingIndicator" class="typing-indicator" style="display: none;">
                        <span id="typingUser"></span> –ø–µ—á–∞—Ç–∞–µ—Ç...
                    </div>
                </div>
            </div>
        </main>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div id="mediaModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ–¥–∏–∞</h3>
                    <button class="btn btn-icon" onclick="closeMediaPicker()">‚úï</button>
                </div>
                <div class="modal-body">
                    <input type="file" id="mediaFile" accept="image/*,video/*,audio/*" multiple>
                    <div class="media-preview" id="mediaPreview"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeMediaPicker()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-primary" onclick="sendMedia()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="stickerModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–∫–µ—Ä</h3>
                    <button class="btn btn-icon" onclick="closeStickerPicker()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="stickers-grid" id="stickersGrid">
                        <!-- –°—Ç–∏–∫–µ—Ä—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>
        </div>

        <div id="rateModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–û—Ü–µ–Ω–∏—Ç–µ —á–∞—Ç</h3>
                    <button class="btn btn-icon" onclick="closeRateModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="rating-stars">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                    <textarea id="reviewComment" placeholder="–í–∞—à –æ—Ç–∑—ã–≤ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="3"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeRateModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-primary" onclick="submitReview()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
                </div>
            </div>
        </div>

        <div id="message" class="message"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/socket-client.js"></script>
</body>
</html>
